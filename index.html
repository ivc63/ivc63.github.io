<html>
<head>
<title>Быстрая диагностика проблем подключения к туннелям</title>
</head>
<body bgcolol="#A8E4A0">
<p>&nbsp;</p>
<p style="text-align: center;"><span style="font-size:18px">Быстрая диагностика проблем подключения к туннелям</span></p>
<p style="text-align: center;"><a href="http://ivc63.github.io/run.bat"><img alt="Скачать" src="http://ivc63.github.io/button1.png" /></a></p>
<p style="text-align: center;"><span style="font-size:16px">Работает с Windows 7/8/10/2008/2012</span><br /></p>
<p style="text-align: center;"><span style="font-size:16px">Необходимо запускать от имени администратора</span><br /></p>
<?php
$file="statisctic.log";
$col_zap=2000;

function getRealIpAddr() {
  if (!empty($_SERVER['HTTP_CLIENT_IP']))
  { $ip=$_SERVER['HTTP_CLIENT_IP']; }
  elseif (!empty($_SERVER['HTTP_X_FORWARDED_FOR'])) 
  { $ip=$_SERVER['HTTP_X_FORWARDED_FOR']; }
  else { $ip=$_SERVER['REMOTE_ADDR']; }
  return $ip;
}

if (strstr($_SERVER['HTTP_USER_AGENT'], 'YandexBot')) {$bot='YandexBot';}
elseif (strstr($_SERVER['HTTP_USER_AGENT'], 'Googlebot')) {$bot='Googlebot';}
else { $bot=$_SERVER['HTTP_USER_AGENT']; }

$ip = getRealIpAddr();
$date = date("H:i:s d.m.Y");
$home = $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'];
$lines = file($file);
while(count($lines) > $col_zap) array_shift($lines);
$lines[] = $date."|".$bot."|".$ip."|".$home."|\r\n";
file_put_contents($file, $lines);
?>
</body>
</html>
